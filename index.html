<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Transform Studio – Előtte–Utána (Admin & Login)</title>
  <meta name="description" content="AI Before–After Transformations – Lakás • Kert • Autó • Stílus">
  <link rel="icon" href="assets/logo-square.png">
  <link rel="stylesheet" href="assets/ats.css">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=AQsaQCLj0og2wsfMoDKAqxJieD2cgXwWq5cssAJCJbO2KoYE8LGHCREyR4vMzMfKZK68qw6EY7IAxMYF&currency=EUR"></script>

  <style>
    body{margin:0;background:#fafafa; font-family: sans-serif;}
    .ats-card .ats-slider{aspect-ratio:16/9;height:auto;overflow:hidden;position:relative}
    .ats-card .ats-slider img, .ats-card .ats-slider .ats-overlay img{width:100%;height:100%;object-fit:cover;display:block}
    .pkg-note{opacity:.85;margin-left:4px;font-weight:500}
    .ats-cta-notes{margin-top:6px;font-size:14px;color:#666;text-align:center}
    
    /* Login stílusok */
    .auth-section { display: none; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 400px; margin: 20px auto; }
    .nav-user-info { font-size: 14px; display: flex; align-items: center; gap: 10px; }
    .logout-btn { color: #ff4d4d; cursor: pointer; text-decoration: underline; }
    .admin-free-btn { background: #4CAF50 !important; color: white !important; font-weight: bold; }
  </style>
</head>
<body>
  <header class="ats-nav">
    <div class="wrap" style="display: flex; justify-content: space-between; align-items: center;">
      <div style="display: flex; align-items: center;">
        <img src="assets/logo-square.png" alt="logo" class="nav-logo">
        <div class="brand">AI Transform Studio</div>
      </div>
      <div id="nav-auth-section">
        <a class="nav-cta" href="#auth">Belépés</a>
      </div>
    </div>
  </header>

  <main>
    <section id="auth-page" class="auth-section">
      <h2 style="text-align:center">Bejelentkezés</h2>
      <form id="login-form" style="display:flex; flex-direction:column; gap:10px;">
        <input type="email" id="login-email" placeholder="Email" style="padding:10px; border:1px solid #ccc; border-radius:4px;" required>
        <input type="password" id="login-pass" placeholder="Jelszó" style="padding:10px; border:1px solid #ccc; border-radius:4px;" required>
        <button type="submit" style="padding:10px; background:#gold; border:none; border-radius:4px; cursor:pointer; background:#222; color:white;">Mehet</button>
      </form>
    </section>

    <section id="main-content" class="ats-container">
      <div class="ats-hero">
        <img src="assets/logo-wide.png" alt="AI Transform Studio" class="ats-logo" />
        <h1>AI Előtte–Utána Átalakítások</h1>
        <p class="ats-sub">Lakás • Kert • Autó • Stílus – Látványtervek 24 órán belül</p>

        <div id="pricing-area" class="ats-cta">
          <a id="ats-buy-basic" class="btn"><strong>Alap</strong> – €3.99 <span class="pkg-note">(1 kép)</span></a>
          <a id="ats-buy-pro" class="btn btn-outline"><strong>Prémium</strong> – €14.99 <span class="pkg-note">(5 kép)</span></a>
          <a id="ats-buy-extra" class="btn btn-dark"><strong>Extra</strong> – €29.99 <span class="pkg-note">(10 kép)</span></a>
        </div>
        
        <div id="admin-area" style="display:none; text-align:center; margin-top:20px;">
            <p style="color: green; font-weight: bold;">Üdvözöljük, Admin! Önnek a generálás ingyenes.</p>
            <button id="admin-free-go" class="btn admin-free-btn">INGYENES FELTÖLTÉS (ADMIN)</button>
        </div>

        <div id="paypal-container" class="w-full max-w-xs mx-auto mt-6"></div>
      </div>

      <div class="ats-grid">
          </div>
    </section>
  </main>

  <script>
    const SUPABASE_URL = "https://bxtpnotswnwrbycvfypz.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ4dHBub3Rzd253cmJ5Y3ZmeXB6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTQ0NDcsImV4cCI6MjA2ODQ5MDQ0N30.CXEfo_8qmIYhkEZFdTsbl9ZB-PRTP6UK8EbIxxpSGZc";
    const supaClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    const ADMIN_EMAIL = "atika.76@windowslive.com";

    (async function() {
      // Alapbeállítások betöltése
      let cfg = { brand: "AI Transform Studio", form_url: "https://docs.google.com/forms/your-link", prices: {EUR: {basic:"3.99", pro:"14.99", extra:"29.99"}} };
      try {
        const r = await fetch('assets/ats-config.json', { cache: 'no-store' });
        if (r.ok) cfg = Object.assign(cfg, await r.json());
      } catch(e) {}

      // Auth állapot ellenőrzése
      const { data: { session } } = await supaClient.auth.getSession();
      updateAuthUI(session);

      function updateAuthUI(session) {
        const navAuth = document.getElementById('nav-auth-section');
        const adminArea = document.getElementById('admin-area');
        const pricingArea = document.getElementById('pricing-area');

        if (session) {
          const email = session.user.email;
          navAuth.innerHTML = `
            <div class="nav-user-info">
              <span>${email}</span>
              <span class="logout-btn" onclick="doLogout()">Kilépés</span>
            </div>`;
          
          if (email === ADMIN_EMAIL) {
            adminArea.style.display = "block";
            pricingArea.style.display = "none";
          }
        } else {
          navAuth.innerHTML = `<a class="nav-cta" href="#auth" onclick="showAuth()">Belépés</a>`;
          adminArea.style.display = "none";
          pricingArea.style.display = "flex";
        }
      }

      window.showAuth = () => {
          document.getElementById('auth-page').style.display = "block";
          window.scrollTo(0, 0);
      };

      window.doLogout = async () => {
          await supaClient.auth.signOut();
          window.location.reload();
      };

      // Login kezelés
      document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;
        const { error } = await supaClient.auth.signInWithPassword({ email, password: pass });
        if (error) alert("Hiba: " + error.message);
        else window.location.reload();
      });

      // Ingyenes admin gomb
      document.getElementById('admin-free-go').addEventListener('click', () => {
          window.location.href = cfg.form_url;
      });

      // PayPal funkciók (a régiből)
      function renderPayPalButtons(packageKey) {
        const price = cfg.prices.EUR[packageKey];
        const container = document.getElementById('paypal-container');
        container.innerHTML = '';
        paypal.Buttons({
          createOrder: (data, actions) => actions.order.create({
            purchase_units: [{ amount: { currency_code:'EUR', value: price } }]
          }),
          onApprove: (data, actions) => actions.order.capture().then(() => {
            window.location.href = cfg.form_url;
          })
        }).render('#paypal-container');
      }

      document.getElementById('ats-buy-basic').onclick = () => renderPayPalButtons('basic');
      document.getElementById('ats-buy-pro').onclick = () => renderPayPalButtons('pro');
      document.getElementById('ats-buy-extra').onclick = () => renderPayPalButtons('extra');

    })();
  </script>
</body>
</html>
