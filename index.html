<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AI Transform Studio – Előtte–Utána (Admin & Listázás)</title>
  <meta name="description" content="AI Before–After Transformations – Lakás • Kert • Autó • Stílus">
  <meta property="og:title" content="AI Transform Studio">
  <meta property="og:description" content="Előtte–Utána AI átalakítások 24 órán belül">
  <meta property="og:type" content="website">
  <link rel="icon" href="assets/logo-square.png">
  <link rel="stylesheet" href="assets/ats.css">
  
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://www.paypal.com/sdk/js?client-id=AQsaQCLj0og2wsfMoDKAqxJieD2cgXwWq5cssAJCJbO2KoYE8LGHCREyR4vMzMfKZK68qw6EY7IAxMYF&currency=EUR"></script>

  <style>
    body{margin:0;background:#fafafa; font-family: sans-serif;}

    /* FIX: kártyák 16:9 arányban, képek szépen vágva */
    .ats-card .ats-slider{aspect-ratio:16/9;height:auto;overflow:hidden;position:relative}
    .ats-card .ats-slider img,
    .ats-card .ats-slider .ats-overlay img{width:100%;height:100%;object-fit:cover;display:block}

    /* Képszám jelzés a gombokon + rövid sor alatta */
    .pkg-note{opacity:.85;margin-left:4px;font-weight:500}
    .ats-cta-notes{margin-top:6px;font-size:14px;color:#666;text-align:center}

    /* --- ÚJ: LOGIN ÉS ADMIN STÍLUSOK --- */
    #auth-section { display: none; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); max-width: 350px; margin: 20px auto; border: 1px solid #eee; }
    .auth-input { width: 100%; padding: 10px; margin: 8px 0; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
    .auth-btn { width: 100%; padding: 10px; background: #222; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .nav-user { font-size: 13px; color: #666; display: flex; align-items: center; gap: 8px; }
    .logout-link { color: #d9534f; cursor: pointer; text-decoration: underline; font-weight: bold; }
    .admin-badge { background: #4CAF50; color: white; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold; }

    #admin-panel { display: none; background: white; padding: 20px; border-radius: 8px; border: 1px solid #ddd; margin-top: 30px; }
    .admin-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
    .admin-table th, .admin-table td { text-align: left; padding: 10px; border-bottom: 1px solid #eee; }
    .admin-table th { background: #f9f9f9; }
  </style>
</head>
<body>
  <header class="ats-nav">
    <div class="wrap" style="display: flex; justify-content: space-between; align-items: center;">
      <div style="display: flex; align-items: center;">
        <img src="assets/logo-square.png" alt="logo" class="nav-logo">
        <div class="brand">AI Transform Studio</div>
      </div>
      
      <div id="nav-auth-area">
        <a class="nav-cta" href="#auth" onclick="toggleAuth()">Belépés</a>
      </div>
    </div>
  </header>

  <main>
    <section id="auth-section">
      <h3 style="margin-top:0; text-align:center;">Admin Belépés</h3>
      <form id="login-form">
        <input type="email" id="login-email" class="auth-input" placeholder="Email cím" required>
        <input type="password" id="login-pass" class="auth-input" placeholder="Jelszó" required>
        <button type="submit" class="auth-btn">Bejelentkezés</button>
      </form>
    </section>

    <section id="ai-transform-studio" class="ats-container">
      <div class="ats-hero">
        <img src="assets/logo-wide.png" alt="AI Transform Studio" class="ats-logo" />
        <h1>AI Előtte–Utána Átalakítások</h1>
        <p class="ats-sub">Lakás • Kert • Autó • Stílus – Látványtervek 24 órán belül</p>

        <div id="pricing-wrapper">
            <div class="ats-cta">
              <a id="ats-buy-basic" class="btn"><strong>Alap</strong> – €3.99 <span class="pkg-note">(1 kép)</span></a>
              <a id="ats-buy-pro" class="btn btn-outline"><strong>Prémium</strong> – €14.99 <span class="pkg-note">(5 kép)</span></a>
              <a id="ats-buy-extra" class="btn btn-dark"><strong>Extra</strong> – €29.99 <span class="pkg-note">(10 kép + 2 variáció/kép)</span></a>
            </div>
            <div id="ats-cta-notes" class="ats-cta-notes">Alap: (1 kép) • Prémium: (5 kép) • Extra: (10 kép + 2 variáció/kép)</div>
        </div>

        <div id="admin-free-area" style="display:none; text-align:center; margin-top:20px;">
            <p style="color:#2e7d32; font-weight:bold;">Üdvözöljük Admin! Számodra a generálás ingyenes.</p>
            <a id="admin-free-btn" class="btn" style="background:#4CAF50; color:white; border:none; cursor:pointer;">INGYENES GENERÁLÁS (ADMIN)</a>
        </div>

        <div id="paypal-container" class="w-full max-w-xs mx-auto mt-6"></div>
      </div>

      <section id="admin-panel">
          <h2 style="margin-top:0;">Beérkezett megrendelések</h2>
          <table class="admin-table">
              <thead>
                  <tr>
                      <th>Dátum</th>
                      <th>Email</th>
                      <th>Csomag</th>
                  </tr>
              </thead>
              <tbody id="admin-order-list">
                  <tr><td colspan="3" style="text-align:center; color:gray;">Nincsenek rendelések...</td></tr>
              </tbody>
          </table>
      </section>

      <div class="ats-grid">
        <div class="ats-card">
          <div class="ats-slider"
               data-before="assets/assetspool_before.jpg"
               data-after="assets/assetspool_after.jpg">
            <img src="assets/assetspool_before.jpg" class="ats-img" alt="Kert medencével - Előtte">
            <div class="ats-overlay"><div class="ats-handle"></div></div>
          </div>
          <div class="ats-caption">Kert medencével – Előtte/Utána</div>
        </div>

        <div class="ats-card">
          <div class="ats-slider" data-before="assets/kert_before.jpg" data-after="assets/kert_after.jpg">
            <img src="assets/kert_before.jpg" class="ats-img" alt="Mediterrán kert előtte">
            <div class="ats-overlay"><div class="ats-handle"></div></div>
          </div>
          <div class="ats-caption">Mediterrán kert – Előtte/Utána</div>
        </div>

        <div class="ats-card">
          <div class="ats-slider" data-before="assets/haz_before.jpg" data-after="assets/haz_after.jpg">
            <img src="assets/haz_before.jpg" class="ats-img" alt="Házfelújítás előtte">
            <div class="ats-overlay"><div class="ats-handle"></div></div>
          </div>
          <div class="ats-caption">Családi ház felújítás – Előtte/Utána</div>
        </div>
      </div>

      <div class="ats-info">
        <h2>Hogyan működik?</h2>
        <ol>
          <li>Válaszd ki a csomagot, és fizess a felugró PayPal ablakban.</li>
          <li>Sikeres fizetés után automatikusan átirányítunk a fotófeltöltő űrlapra (Google Form).</li>
          <li>24 órán belül elkészítjük az Előtte–Utána képeket és e-mailben küldjük.</li>
        </ol>
      </div>
    </section>
  </main>

  <footer class="ats-footer">
    <div class="wrap">© <span id="y"></span> AI Transform Studio</div>
  </footer>

  <script>
    // 1. SUPABASE KONFIGURÁCIÓ
    const SUPABASE_URL = "https://bxtpnotswnwrbycvfypz.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ4dHBub3Rzd253cmJ5Y3ZmeXB6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI5MTQ0NDcsImV4cCI6MjA2ODQ5MDQ0N30.CXEfo_8qmIYhkEZFdTsbl9ZB-PRTP6UK8EbIxxpSGZc";
    const supaClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    const ADMIN_EMAIL = "atika.76@windowslive.com";

    (async function() {
      const DEFAULT_PRICES = {basic:"3.99", pro:"14.99", extra:"29.99"};
      let cfg = { brand: "AI Transform Studio", form_url: "", prices: {EUR: DEFAULT_PRICES} };
      try {
        const r = await fetch('assets/ats-config.json', { cache: 'no-store' });
        if (r.ok) cfg = Object.assign(cfg, await r.json());
      } catch(e) {}

      // --- AUTH KEZELÉS ---
      const authSection = document.getElementById('auth-section');
      const navAuthArea = document.getElementById('nav-auth-area');
      const pricingWrapper = document.getElementById('pricing-wrapper');
      const adminFreeArea = document.getElementById('admin-free-area');
      const adminPanel = document.getElementById('admin-panel');

      window.toggleAuth = () => {
          authSection.style.display = (authSection.style.display === 'block') ? 'none' : 'block';
      };

      async function updateUI() {
          const { data: { session } } = await supaClient.auth.getSession();
          if (session) {
              const email = session.user.email;
              const isAdmin = (email === ADMIN_EMAIL);
              
              navAuthArea.innerHTML = `
                <div class="nav-user">
                    ${isAdmin ? '<span class="admin-badge">ADMIN</span>' : ''}
                    <span>${email}</span>
                    <span class="logout-link" onclick="logout()">Kilépés</span>
                </div>`;
              authSection.style.display = 'none';

              if (isAdmin) {
                  pricingWrapper.style.display = 'none';
                  adminFreeArea.style.display = 'block';
                  adminPanel.style.display = 'block';
                  loadOrders();
                  document.getElementById('admin-free-btn').onclick = () => {
                      if (cfg.form_url) window.location.href = cfg.form_url;
                  };
              }
          }
      }

      window.logout = async () => { await supaClient.auth.signOut(); window.location.reload(); };

      document.getElementById('login-form').addEventListener('submit', async (e) => {
          e.preventDefault();
          const email = document.getElementById('login-email').value;
          const pass = document.getElementById('login-pass').value;
          const { error } = await supaClient.auth.signInWithPassword({ email, password: pass });
          if (error) alert("Hiba: " + error.message);
          else window.location.reload();
      });

      window.loadOrders = async () => {
          const { data, error } = await supaClient.from('ats_rendelesek').select('*').order('created_at', {ascending: false});
          if (!error && data) {
              const list = document.getElementById('admin-order-list');
              list.innerHTML = data.map(o => `<tr><td>${new Date(o.created_at).toLocaleDateString()}</td><td>${o.email}</td><td>${o.csomag_neve}</td></tr>`).join('');
          }
      };

      updateUI();

      // --- PAYPAL ÉS SLIDER ---
      function renderPayPalButtons(packageKey) {
        const prices = (cfg && cfg.prices && cfg.prices.EUR) ? cfg.prices.EUR : DEFAULT_PRICES;
        const PACK_INFO = {
          basic:  {label:'Alap',    note:'(1 kép)'},
          pro:    {label:'Prémium', note:'(5 kép)'},
          extra:  {label:'Extra',   note:'(10 kép + 2 variáció/kép)'}
        };
        const price = prices[packageKey];
        const description = `AI Transform Studio – ${PACK_INFO[packageKey].label} ${PACK_INFO[packageKey].note}`;
        const container = document.getElementById('paypal-container');
        if(!price){ alert('Hiba: A csomag ára nincs beállítva.'); return; }
        container.innerHTML = '';
        paypal.Buttons({
          style: { layout:'vertical', color:'gold', shape:'rect', label:'paypal', height:40 },
          createOrder: (data, actions) => actions.order.create({
            purchase_units: [{ description, amount: { currency_code:'EUR', value: Number(price).toFixed(2) } }]
          }),
          onApprove: (data, actions) => actions.order.capture().then(async (details) => {
            // MENTÉS AZ ADATBÁZISBA
            await supaClient.from('ats_rendelesek').insert({
                email: details.payer.email_address,
                csomag_neve: packageKey
            });

            alert('Sikeres fizetés! Átirányítunk a fotófeltöltő űrlapra.');
            if (cfg.form_url && cfg.form_url.startsWith('http')) window.location.href = cfg.form_url;
            else alert('Hiba: a form_url nincs beállítva az assets/ats-config.json fájlban.');
          }),
          onError: (err) => { alert('Hiba történt a fizetés során.'); }
        }).render('#paypal-container');
      }

      document.getElementById('ats-buy-basic')?.addEventListener('click', (e) => { e.preventDefault(); renderPayPalButtons('basic'); });
      document.getElementById('ats-buy-pro')?.addEventListener('click',   (e) => { e.preventDefault(); renderPayPalButtons('pro');   });
      document.getElementById('ats-buy-extra')?.addEventListener('click', (e) => { e.preventDefault(); renderPayPalButtons('extra'); });
      document.getElementById('nav-buy')?.addEventListener('click',       (e) => { e.preventDefault(); renderPayPalButtons('pro');   });

      const initSlider = (slider) => {
        const afterSrc = slider.getAttribute('data-after');
        const overlay = slider.querySelector('.ats-overlay'); if (!overlay) return;
        const afterImg = new Image(); afterImg.src = afterSrc; afterImg.alt = 'After';
        overlay.insertBefore(afterImg, overlay.firstChild);
        const handle = slider.querySelector('.ats-handle'); if (!handle) return;
        let active = false;
        const setPos = (x) => {
          const r = slider.getBoundingClientRect();
          let t = (x - r.left) / r.width;
          t = Math.max(0, Math.min(1, t));
          overlay.style.width = (t * 100) + '%';
          handle.style.left = (t * 100) + '%';
        };
        slider.addEventListener('pointerdown', e => { active = true; setPos(e.clientX); });
        window.addEventListener('pointerup', () => active = false);
        window.addEventListener('pointermove', e => { if (active) setPos(e.clientX); });
        const r = slider.getBoundingClientRect();
        setPos(r.left + r.width / 2);
      };
      document.querySelectorAll('.ats-slider').forEach(initSlider);

      document.getElementById('y').textContent = new Date().getFullYear();
    })();
  </script>
</body>
</html>
